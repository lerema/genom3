%
% Copyright (c) 2009-2010 LAAS/CNRS
% All rights reserved.
%
% Permission to use, copy, modify, and distribute this software for any purpose
% with or without   fee is hereby granted, provided   that the above  copyright
% notice and this permission notice appear in all copies.
%
% THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
% REGARD TO THIS  SOFTWARE INCLUDING ALL  IMPLIED WARRANTIES OF MERCHANTABILITY
% AND FITNESS. IN NO EVENT SHALL THE AUTHOR  BE LIABLE FOR ANY SPECIAL, DIRECT,
% INDIRECT, OR CONSEQUENTIAL DAMAGES OR  ANY DAMAGES WHATSOEVER RESULTING  FROM
% LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
% OTHER TORTIOUS ACTION,   ARISING OUT OF OR IN    CONNECTION WITH THE USE   OR
% PERFORMANCE OF THIS SOFTWARE.
%
%                                             Anthony Mallet on Sat May  8 2010
%
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{genom}[2010/05/08 Genom Manual LaTeX style]

\RequirePackage{framed}
\RequirePackage{color}
\definecolor{color@link}{rgb}{.4,.02,.01}

\RequirePackage{type1cm}
\RequirePackage{ifpdf}
\RequirePackage[pdftex]{hyperref}

\hypersetup{plainpages=false}
\hypersetup{colorlinks=true,linkcolor=color@link,urlcolor=color@link}

\ifpdf\pdfinfo{
   /Author (Sara Fleury, Matthieu Herrb, Anthony Mallet)
   /Title  (Genom Manual)
   /CreationDate (D:20100508000000)
   /Subject (Genom)
   /Keywords (Genom robotic software component code generation)
}\fi


% --- Misc commands --------------------------------------------------------

% output a coma if not already looking at a punctuation sign
\def\singlepunct{\@ifnextchar.\relax{\@ifnextchar,\relax{\@ifnextchar)\relax{, }}}}

% dot leaders
\def\xdotfill{ \dotfill\ }

% extendef \ref
\def\xref#1#2{#2, \nameref{#1}\singlepunct}

% double horizontal line (in a table)
\def\doublehline{\hline\hline}

% GenoM
\def\GenoM{G\textsuperscript{en}oM}

% Add to index
\def\I#1{\index{#1}#1}


% --- Sections -------------------------------------------------------------

% title
\title{\@@title\pdfbookmark[0]{Title}{title.0}}
\def\title#1{\gdef\@@title{\fontfamily{lmss}#1}}

% contents
\def\contentsname{Contents\pdfbookmark[0]{Contents}{chapter.0}}

% chapters
\def\chapter{%
   \if@openright\newpage{\pagestyle{empty}\cleardoublepage}\else\clearpage\fi%
   \thispagestyle{empty}%
   \global\@topnum\z@%
   \@afterindentfalse%
   \secdef\@chapter\@schapter%
}

\def\@makechapterhead#1{%
   \vrule height 15pt width 0pt\par{%
      \parindent\z@%
      \raggedleft\normalfont%
      \ifnum\c@secnumdepth>\m@ne%
	 \if@mainmatter%
            \fontsize{25}{25}\fontfamily{lmss}\bfseries%
	    \thechapter\par\vrule height 0pt width 0pt\par%
	 \fi%
      \fi%
      \interlinepenalty\@M\fontsize{30}{30}\bfseries%
      \parbox{\textwidth}{\raggedleft#1}\par%
      \nobreak\vskip3\evensidemargin%
   }%
}

\def\@makeschapterhead#1{
   \vrule height 15pt width 0pt\par{%
      \parindent\z@
      \raggedleft\normalfont
      \interlinepenalty\@M\fontsize{30}{35}\fontfamily{lmss}\bfseries
      \parbox{\textwidth}{\raggedleft#1}\par
      \nobreak\vskip3\evensidemargin
   }
}

% descriptions
\def\description{
   \list{}{%
      \labelwidth0pt\itemindent-\leftmargin\let\makelabel\descriptionlabel%
      \let\@@item\@item\def\@item[##1]{\@@item[##1]\hfill\\}
   }%
}

% biblio
\def\thebibliography#1{
   \chapter*{\bibname}\chaptermark{\bibname}
   \phantomsection\addcontentsline{toc}{chapter}{\bibname}%
   \list{\@biblabel{\@arabic\c@enumiv}}
   {
      \settowidth\labelwidth{\@biblabel{#1}}
      \leftmargin\labelwidth\advance\leftmargin\labelsep
      \@openbib@code
      \usecounter{enumiv}\let\p@enumiv\@empty
      \renewcommand\theenumiv{\@arabic\c@enumiv}
   }
   \sloppy\clubpenalty4000\@clubpenalty\clubpenalty\widowpenalty4000
   \sfcode`\.\@m
   \small%
}

% index
\def\theindex{
   \columnsep3em\twocolumn%
   \chapter*{\indexname}\chaptermark{\indexname}%
   \phantomsection\addcontentsline{toc}{chapter}{\indexname}%
   \parindent\z@\parskip\z@\@plus.3\p@\relax
   \let\item\@idxitem%
   \small%
}
\def\indexheading#1{\fontfamily{lmss}\bfseries\large #1}

% --- Custom environments --------------------------------------------------

% grammar rules
\newenvironment{grammar}[1]{%
   \topsep=0pt\partopsep=0pt%
   \fontfamily{lmss}\selectfont\footnotesize%
   \begin{itemize}\item[(#1)\hspace{20pt}]%
}{%
   \end{itemize}%
}

% engine commands
\newenvironment{engcmd}[1]{%
   \setlength{\FrameRule}{0.1pt}
   \setlength{\fboxsep}{5pt}
   \def\FrameCommand{\colorbox[rgb]{0.99,0.99,0.97}}
   \begin{framed}\noindent
   \setlength{\fboxsep}{3pt}
   \fcolorbox[rgb]{.6,.6,.6}{1.0,1.0,0.9}{\parbox{0.95\linewidth}{\tt #1}}%
   \bigbreak%
   \def\engarg@name{Parameters:}%
   \setlength{\parindent}{0pt}%
}{
   \end{framed}
}

\long\def\engcmdarg#1#2{%
   \medbreak\noindent{\bf\engarg@name\par}%
   \def\engarg@name{}%
   \hspace{0.1\linewidth}\parbox[t]{0.15\linewidth}{\em #1}\hfill%
   \parbox[t]{0.7\linewidth}{#2}
   \par
}

\long\def\engcmdret#1{%
   \medbreak\noindent{\bf Returns:\medbreak}%
   \hspace{0.1\linewidth}\parbox{0.85\linewidth}{#1}%
   \bigbreak
}
